# Участие в Universo Platformo Ruby

Благодарим вас за интерес к участию в Universo Platformo Ruby! Этот документ содержит рекомендации и инструкции по участию в проекте.

## Кодекс поведения

Мы стремимся создать гостеприимную и инклюзивную среду для всех участников. Пожалуйста, будьте уважительны и конструктивны во всех взаимодействиях.

## Начало работы

1. **Прочитайте документацию**
   - [README.md](README.md) / [README-RU.md](README-RU.md) - Обзор проекта
   - [DEVELOPMENT.md](DEVELOPMENT.md) / [DEVELOPMENT-RU.md](DEVELOPMENT-RU.md) - Руководство по разработке
   - [Конституция](/.specify/memory/constitution.md) - Основные принципы
   - [Инструкции GitHub](/.github/instructions/) - Рекомендации по workflow

2. **Настройте среду разработки**
   - Следуйте инструкциям в [DEVELOPMENT-RU.md](DEVELOPMENT-RU.md)
   - Убедитесь, что все тесты проходят перед внесением изменений

## Процесс участия

### 1. Создайте Issue

Перед началом работы создайте Issue, следуя рекомендациям в `.github/instructions/github-issues.md`:

- Напишите Issue на английском с переводом на русский в разделе со спойлером
- Используйте точный формат спойлера: `<summary>In Russian</summary>`
- Примените соответствующие метки (см. `.github/instructions/github-labels.md`)
- Чётко опишите проблему или функцию
- Включите критерии приёмки

Пример структуры Issue:

```markdown
# Update menu items

Description of the change in English...

<details>
<summary>In Russian</summary>

Описание изменения на русском...
</details>
```

### 2. Создайте feature branch

```bash
git checkout -b feature/описательное-имя
# или
git checkout -b fix/описание-бага
```

### 3. Внесите изменения

Следуйте этим рекомендациям:

#### Стиль кода

- Следуйте соглашениям Ruby on Rails
- Используйте RuboCop для линтинга: `bundle exec rubocop`
- Максимальная длина строки: 120 символов
- Используйте двойные кавычки для строк
- Пишите чёткие, описательные имена переменных и методов

#### Тестирование

- Пишите тесты для всей новой функциональности
- Убедитесь, что все тесты проходят: `bundle exec rspec`
- Поддерживайте покрытие тестами выше 90%
- Используйте FactoryBot для тестовых фикстур
- Следуйте лучшим практикам RSpec

#### Документация

- Обновляйте файлы README при добавлении функций
- Добавляйте комментарии к коду для сложной логики
- Документируйте публичные API
- **Всегда поддерживайте двуязычную документацию** (английский и русский)
- **Обеспечьте идентичное количество строк** между языковыми версиями

#### Интернационализация

- Весь текст интерфейса должен использовать Rails I18n: `t('key')`
- Добавляйте переводы в оба файла `config/locales/en.yml` и `config/locales/ru.yml`
- Тестируйте с разными локалями

### 4. Зафиксируйте изменения

Пишите чёткие сообщения коммитов:

```bash
git add .
git commit -m "Add feature: краткое описание"
```

Рекомендации по сообщениям коммитов:
- Используйте настоящее время ("Add feature", а не "Added feature")
- Будьте описательны, но лаконичны
- Ссылайтесь на номер Issue, если применимо

### 5. Запустите проверки качества

Перед отправкой запустите:

```bash
# Тесты
bundle exec rspec

# Линтер
bundle exec rubocop

# Проверки безопасности
bundle exec brakeman
bundle exec bundle-audit check --update
```

### 6. Отправьте ветку

```bash
git push origin feature/описательное-имя
```

### 7. Создайте Pull Request

Следуйте рекомендациям в `.github/instructions/github-pr.md`:

- Формат заголовка: `GH{номер_issue} Описание`
- Включите описание на английском с переводом на русский в спойлере
- Используйте точный формат спойлера: `<summary>In Russian</summary>`
- Свяжите с соответствующим Issue с помощью `Fixes #123`
- Примените соответствующие метки
- Включите раздел "Additional Work" для дополнительных изменений

Пример структуры PR:

```markdown
Fixes #123

# Description

Description of changes in English...

## Changes Made

- Change 1
- Change 2

## Additional Work

- Documentation updates
- Test additions

## Testing

- [x] Manual testing completed
- [x] Automated tests pass
- [x] No breaking changes introduced

<details>
<summary>In Russian</summary>

Исправляет #123

# Описание

Описание изменений на русском...

## Внесенные изменения

- Изменение 1
- Изменение 2

## Дополнительная работа

- Обновления документации
- Добавление тестов

## Тестирование

- [x] Ручное тестирование завершено
- [x] Автоматические тесты проходят
- [x] Не внесено критических изменений
</details>
```

## Разработка пакетов

При создании новых пакетов:

1. Следуйте структуре монорепозитория в `packages/`
2. Используйте соглашение об именовании: `<функция>-frt` для фронтенда, `<функция>-srv` для бэкенда
3. Включите директорию `base/` в каждый пакет
4. Создайте README.md и README-RU.md для каждого пакета
5. См. `packages/PACKAGE_README_TEMPLATE.md` для шаблона

## Стандарты кодирования

### Лучшие практики Ruby/Rails

- Строго следуйте паттерну MVC
- Используйте сервисные объекты для сложной бизнес-логики
- Держите контроллеры тонкими (макс. 7 строк на действие)
- Используйте concerns для общего поведения
- Предпочитайте функциональные методы императивному коду
- Используйте миграции базы данных для изменений схемы
- Добавляйте индексы для часто запрашиваемых столбцов

### Безопасность

- Никогда не фиксируйте конфиденциальные данные (учётные данные, ключи)
- Используйте переменные окружения для конфигурации
- Проверяйте все пользовательские вводы
- Используйте параметризованные запросы (ActiveRecord обрабатывает это)
- Запускайте проверки безопасности: `bundle exec brakeman`

### Производительность

- Используйте eager loading, чтобы избежать запросов N+1
- Добавляйте индексы базы данных соответствующим образом
- Кэшируйте дорогие операции
- Отслеживайте с помощью rack-mini-profiler в разработке

## Стандарты документации

### Файлы README

- Должны существовать как на английском (README.md), так и на русском (README-RU.md)
- Должны иметь идентичную структуру и количество строк
- Включают: обзор, установку, использование, тестирование

### Комментарии к коду

- Пишите на английском
- Объясняйте ПОЧЕМУ, а не ЧТО
- Документируйте сложные алгоритмы
- Используйте формат документации YARD для публичных API

### Встроенная документация

```ruby
# Хорошо
# Calculates weighted average based on priority to ensure
# high-priority items have greater influence on the result
def weighted_average(items)
  # реализация
end

# Плохо
# Calculates average
def weighted_average(items)
  # реализация
end
```

## Рекомендации по тестированию

### Покрытие тестами

- Стремитесь к >90% покрытию кода
- Тестируйте все граничные случаи
- Тестируйте обработку ошибок
- Тестируйте валидации и ассоциации

### Структура теста

```ruby
RSpec.describe Cluster, type: :model do
  describe 'validations' do
    it { should validate_presence_of(:name) }
  end

  describe 'associations' do
    it { should have_many(:domains) }
  end

  describe '#method_name' do
    context 'when condition' do
      it 'returns expected result' do
        # реализация теста
      end
    end
  end
end
```

### Использование фабрик

```ruby
# Создавайте тестовые данные с помощью фабрик
let(:cluster) { create(:cluster) }
let(:domain) { create(:domain, cluster: cluster) }
```

## Процесс проверки Pull Request

1. Автоматические проверки должны пройти (тесты, линтинг, безопасность)
2. Проверка кода сопровождающим
3. Устраните комментарии по проверке
4. Одобрение как минимум одним сопровождающим
5. Слияние с основной веткой

## Вопросы или проблемы?

- Проверьте [DEVELOPMENT-RU.md](DEVELOPMENT-RU.md) для инструкций по разработке
- Просмотрите существующие Issues и Pull Requests
- Откройте новый Issue для вопросов
- Свяжитесь с сопровождающими при необходимости

## Признание заслуг

Участники будут признаны в примечаниях к релизу и документации проекта.

Спасибо за участие в Universo Platformo Ruby!
